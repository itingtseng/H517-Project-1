<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>D3: Loading GeoJSON data and generating SVG paths</title>
    <script type="text/javascript" src="../d3.js"></script>
    <style type="text/css">
    /* No style rules here yet */
    </style>
</head>

<body>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script type="text/javascript">
    //Width and height
    d3.json('data.topojson', function(error, route) {
                var w = 1440;
                var h = 900;

                //Define path generator, using the Albers USA projection
                //var path = d3.geoPath()
                //.projection(d3.geoAlbersUsa());

                //Create SVG element
                var svg = d3.select("body")
                    .append("svg")
                    .attr("width", w)
                    .attr("height", h);
                route = topojson.feature(route, route.objects['metrotransit-green-line.geo']);
                // Make projection and path handler
                var projectionData = route;
                var centroid = d3.geo.centroid(projectionData);
                var projection = d3.geo.albersUsa()
                    .scale(1000)
                    .translate([width / 2, height / 2]);
                var projectionPath = d3.geo.path().projection(projection);
                // Make group for features
                var featureGroup = svg.append('g').attr('class', 'feature-group');
                // Fit map to data
                var b = projectionPath.bounds(projectionData);
                featureGroup.attr('transform',
                    'translate(' + projection.translate() + ') ' +
                    'scale(' + 0.95 / Math.max((b[1][0] - b[0][0]) / width, (b[1][1] - b[0][1]) / height) + ') ' +
                    'translate(' + -(b[1][0] + b[0][0]) / 2 + ',' + -(b[1][1] + b[0][1]) / 2 + ')');
                //Load in GeoJSON data

                d3.json("streets.json", function(json) {

                    //Bind data and create one path per GeoJSON feature
                    svg.selectAll(".route")
                        .data(route.features)
                        .enter()
                        .append("path")
                        .attr("class", "route");
                    .attr('d', projectionPath)
                        .style('fill', 'blue')
                        .style('fill-opacity', 0.05)
                        .style('stroke', 'red')
                        .style('stroke-opacity', 0.75)
                        .style('stroke-width', 0.001);
                });
    </script>
</body>

</html>